<!DOCTYPE html>
<html>
<head>
    <title>MaybePad</title>
    <script src="https://cdn.ckeditor.com/4.14.0/standard/ckeditor.js"></script>
</head>
<body>
<textarea name="editor" id="editor"></textarea>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    var editor = CKEDITOR.replace('editor');

    CKEDITOR.on('instanceReady',
        function( evt )
        {
            var editor = evt.editor;
            editor.execCommand('maximize');
        });

    var path = window.location.pathname;
    console.log(path);
    function saveContent() {
        var content = editor.getData();
        $.ajax({
            url: '/api' + path,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({
                path: path,
                content: content
            }),
            success: function() {
                console.log('Saved');
                loadContent();
            }
        });
    }

    function loadContent() {
        $.ajax({
            url: '/api' + path,
            type: 'GET',
            success: function(data) {
                console.log("get ok")
                console.log(data)
                editor.setData(data.content);
            }
        });
    }

    loadContent();
    setInterval(saveContent, 5000);
</script>
</body>
</html>
