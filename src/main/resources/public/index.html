<!DOCTYPE html>
<html>
<head>
    <title>MaybePad</title>
    <script src="https://cdn.ckeditor.com/4.16.2/full-all/ckeditor.js"></script>
    <style>
        body {
            background-color: #191919;
            color: #E0E0E0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        body.light-mode {
            background-color: #FFF;
            color: #000;
        }

        #editor-container {
            width: 75%;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cke_maximized {
            max-width: 100% !important;
            margin: auto !important;
        }
    </style>
</head>
<body class="dark-mode">
<div id="editor-container">
    <textarea name="editor" id="editor"></textarea>
</div>
<button id="dark-mode-toggle">Alternar Modo Claro</button>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    var editor = CKEDITOR.replace('editor', {
        // Aplicar estilos CSS escuros ao conte√∫do do editor
        contentsCss: [
            'body {background-color: #191919; color: #E0E0E0;}',
            'p {color: #E0E0E0;}'
        ]
    });

    var path = window.location.pathname;
    console.log(path);

    var currentContent = "";
    var saveTimeout = null;
    var saveDelay = 2000; // Save delay in milliseconds

    function saveContent() {
        var content = editor.getData();
        if(content !== currentContent) {
            currentContent = content;
            $.ajax({
                url: '/api' + path,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    path: path,
                    content: content
                }),
                success: function() {
                    console.log('Saved');
                }
            });
        }
    }

    function loadContent() {
        $.ajax({
            url: '/api' + path,
            type: 'GET',
            success: function(data) {
                console.log("get ok")
                console.log(data)
                currentContent = data.content;
                editor.setData(data.content);
            }
        });
    }

    CKEDITOR.on('instanceReady',
        function( evt )
        {
            var editor = evt.editor;
            editor.execCommand('maximize');
            loadContent(); // Load content after editor is ready
        });

    editor.on('change', function() {
        clearTimeout(saveTimeout);
        saveTimeout = setTimeout(saveContent, saveDelay);
    });

    document.getElementById('dark-mode-toggle').addEventListener('click', function() {
        document.body.classList.toggle('light-mode');
    });
</script>
</body>
</html>
